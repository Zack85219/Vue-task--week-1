import{_ as k,r as v,o as d,c as i,d as t,F as E,e as P,f as p,t as h,b as n,w,a as x,g as y,v as I,n as V,p as A,h as L}from"./index-633f8d7a.js";const{VITE_API_URL:c,VITE_API_PATH:u}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"59487@@",BASE_URL:"/Vue3-works/",MODE:"production",DEV:!1,PROD:!0},U={data(){return{loadingStatus:{loadingItem:""},products:[],product:{},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1}},methods:{getProducts(){const a=`${c}/api/${u}/products`;this.$http.get(a).then(e=>{this.products=e.data.products,this.isLoading=!1}).catch(e=>{alert(e.res.data.message)})},getProduct(a){const e=`${c}/api/${u}/product/${a}`;this.loadingStatus.loadingItem=a,this.$http.get(e).then(l=>{this.loadingStatus.loadingItem="",this.product=l.data.product,this.$refs.userProductModal.openModal()}).catch(l=>{alert(l.res.data.message)})},addToCart(a,e=1){const l=`${c}/api/${u}/cart`;this.loadingStatus.loadingItem=a;const _={product_id:a,qty:e};this.$refs.userProductModal.hideModal(),this.$http.post(l,{data:_}).then(s=>{alert(s.data.message),this.loadingStatus.loadingItem="",this.getCart()}).catch(s=>{alert(s.res.data.message)})},updateCart(a){this.loadingStatus.loadingItem=a.id;const e=`${c}/api/${u}/cart/${a.id}`,l={product_id:a.product_id,qty:a.qty};this.$http.put(e,{data:l}).then(_=>{this.loadingStatus.loadingItem="",alert(_.data.message),this.getCart()}).catch(_=>{this.loadingStatus.loadingItem="",alert(_.response.data.message)})},deleteAllCarts(){const a=`${c}/api/${u}/carts`;this.$http.delete(a).then(e=>{alert(e.data.message),this.getCart()}).catch(e=>{alert(e.response.data.message)})},getCart(){const a=`${c}/api/${u}/cart`;this.$http.get(a).then(e=>{this.cart=e.data.data}).catch(e=>{alert(e.res.data.message)})},removeCartItem(a){const e=`${c}/api/${u}/cart/${a}`;this.loadingStatus.loadingItem=a,this.$http.delete(e).then(l=>{alert(l.data.message),this.loadingStatus.loadingItem="",this.getCart()}).catch(l=>{alert(l.res.data.message)})},createOrder(){const a=`${c}/api/${u}/order`,e=this.form;this.$http.post(a,{data:e}).then(l=>{alert(l.data.message),this.$refs.form.resetForm(),this.form.message="",this.getCart()}).catch(l=>{alert(l.response.data.message)})}},mounted(){this.isLoading=!0,this.getProducts(),this.getCart()}},m=a=>(A("data-v-ec4e5606"),a=a(),L(),a),T={class:"container"},q={class:"text-end"},M={class:"table align-middle"},F=m(()=>t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1)),$=["onClick"],B={key:0,class:"fas fa-spinner fa-pulse"},D={key:0,class:"text-success"},N={class:"input-group input-group-sm"},O={class:"input-group mb-3"},R=["onUpdate:modelValue","onBlur"],j={class:"input-group-text",id:"basic-addon2"},H={class:"text-end"},z={key:0,class:"text-success"},G={key:0},J={colspan:"3",class:"text-end"},K={class:"text-end"},Q={key:0},W=m(()=>t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1)),X={class:"text-end text-success"},Y={class:"d-flex justify-content-center"},Z={class:"my-5 row justify-content-center"},tt={class:"mb-3"},et=m(()=>t("label",{for:"email",class:"form-label"},"Email",-1)),st={class:"mb-3"},at=m(()=>t("label",{for:"name",class:"form-label"},"收件人姓名",-1)),ot={class:"mb-3"},lt=m(()=>t("label",{for:"tel",class:"form-label"},"收件人電話",-1)),rt={class:"mb-3"},nt=m(()=>t("label",{for:"address",class:"form-label"},"收件人地址",-1)),dt={class:"mb-3"},it=m(()=>t("label",{for:"message",class:"form-label"},"留言",-1)),ct=m(()=>t("div",{class:"text-end"},[t("button",{class:"btn btn-danger"},"送出訂單")],-1));function ut(a,e,l,_,s,g){const C=v("VueLoading"),f=v("VueField"),b=v("ErrorMessage"),S=v("VueForm");return d(),i("div",T,[t("div",q,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=(...o)=>g.deleteAllCarts&&g.deleteAllCarts(...o))}," 清空購物車 ")]),t("table",M,[F,t("tbody",null,[s.cart.carts?(d(!0),i(E,{key:0},P(s.cart.carts,o=>(d(),i("tr",{key:o.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>g.removeCartItem(o.id)},[s.loadingStatus.loadingItem===o.id?(d(),i("i",B)):p("",!0),x(" x ")],8,$)]),t("td",null,[x(h(o.product.title)+" ",1),o.coupon?(d(),i("div",D,"已套用優惠券")):p("",!0)]),t("td",null,[t("div",N,[t("div",O,[y(t("input",{"onUpdate:modelValue":r=>o.qty=r,onBlur:r=>g.updateCart(o),min:"1",type:"number",class:"form-control"},null,40,R),[[I,o.qty,void 0,{number:!0}]]),t("span",j,h(o.product.unit),1)])])]),t("td",H,[s.cart.final_total!==s.cart.total?(d(),i("small",z,"折扣價：")):p("",!0),x(" "+h(o.final_total),1)])]))),128)):p("",!0)]),s.cart.carts?(d(),i("tfoot",G,[t("tr",null,[t("td",J,h(s.cart.total===0?"":"總計"),1),t("td",K,h(s.cart.total===0?"":s.cart.total),1)]),s.cart.final_total!==s.cart.total?(d(),i("tr",Q,[W,t("td",X,h(s.cart.final_total),1)])):p("",!0)])):p("",!0)]),t("div",Y,h(s.cart.total===0?"目前沒有商品":""),1),n(C,{active:s.isLoading,class:"page-loading"},null,8,["active"]),t("div",Z,[n(S,{ref:"form",class:"col-md-6",onSubmit:g.createOrder},{default:w(({errors:o})=>[t("div",tt,[et,n(f,{id:"email",name:"email",type:"email",class:V(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.form.user.email,"onUpdate:modelValue":e[1]||(e[1]=r=>s.form.user.email=r)},null,8,["class","modelValue"]),n(b,{name:"email",class:"invalid-feedback"})]),t("div",st,[at,n(f,{id:"name",name:"姓名",type:"text",class:V(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":e[2]||(e[2]=r=>s.form.user.name=r)},null,8,["class","modelValue"]),n(b,{name:"姓名",class:"invalid-feedback"})]),t("div",ot,[lt,n(f,{id:"tel",name:"電話",type:"tel",class:V(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:s.form.user.tel,"onUpdate:modelValue":e[3]||(e[3]=r=>s.form.user.tel=r)},null,8,["class","modelValue"]),n(b,{name:"電話",class:"invalid-feedback"})]),t("div",rt,[nt,n(f,{id:"address",name:"地址",type:"text",class:V(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":e[4]||(e[4]=r=>s.form.user.address=r)},null,8,["class","modelValue"]),n(b,{name:"地址",class:"invalid-feedback"})]),t("div",dt,[it,y(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[5]||(e[5]=r=>s.form.message=r)},null,512),[[I,s.form.message]])]),ct]),_:1},8,["onSubmit"])])])}const ht=k(U,[["render",ut],["__scopeId","data-v-ec4e5606"]]);export{ht as default};
